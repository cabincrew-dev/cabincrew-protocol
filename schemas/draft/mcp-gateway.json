{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "MCPGateway",
    "version": "2025-02-01-draft",
    "description": "Request/response and policy configuration for the CabinCrew MCP Gateway. The gateway emits audit events using audit-event.schema.json; no audit schema is duplicated here.",
    "type": "object",
    "properties": {
        "GatewayRequest": {
            "type": "object",
            "description": "An MCP request intercepted by the gateway before policy evaluation.",
            "properties": {
                "request_id": {
                    "type": "string"
                },
                "timestamp": {
                    "type": "string"
                },
                "source": {
                    "type": "string",
                    "description": "Caller identity (engine, orchestrator, agent, etc)."
                },
                "server_id": {
                    "type": "string",
                    "description": "MCP server being contacted (e.g., 'file-server', 'git-server')."
                },
                "method": {
                    "type": "string",
                    "description": "MCP method name (free-form)."
                },
                "params": {
                    "type": "object",
                    "description": "Opaque MCP parameters."
                },
                "context": {
                    "type": "object",
                    "description": "Optional workflow/caller context."
                }
            },
            "required": [
                "request_id",
                "timestamp",
                "server_id",
                "method"
            ]
        },
        "GatewayResponse": {
            "type": "object",
            "description": "Decision produced by the gateway after OPA/ONNX evaluation.",
            "properties": {
                "request_id": {
                    "type": "string"
                },
                "timestamp": {
                    "type": "string"
                },
                "decision": {
                    "type": "string",
                    "enum": [
                        "allow",
                        "warn",
                        "deny",
                        "require_approval"
                    ]
                },
                "warnings": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "violations": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "approval": {
                    "type": "object",
                    "description": "Present only if decision = require_approval.",
                    "properties": {
                        "approval_id": {
                            "type": "string"
                        },
                        "required_role": {
                            "type": "string"
                        },
                        "reason": {
                            "type": "string"
                        }
                    }
                },
                "rewritten_request": {
                    "type": "object",
                    "description": "If policies rewrite the MCP request before forwarding.",
                    "additionalProperties": true
                }
            },
            "required": [
                "request_id",
                "timestamp",
                "decision"
            ]
        },
        "GatewayPolicyConfig": {
            "type": "object",
            "description": "OPA/ONNX rule configuration for the MCP gateway.",
            "properties": {
                "opa_policies": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "onnx_models": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "rules": {
                    "type": "array",
                    "description": "High-level gateway rule definitions (free-form).",
                    "items": {
                        "type": "object",
                        "properties": {
                            "match": {
                                "type": "object",
                                "description": "Pattern to match against server, method, or params.",
                                "additionalProperties": true
                            },
                            "action": {
                                "type": "string",
                                "description": "Result: allow, warn, deny, require_approval (free-form allowed)."
                            },
                            "metadata": {
                                "type": "object",
                                "additionalProperties": true
                            }
                        },
                        "required": [
                            "match",
                            "action"
                        ]
                    }
                }
            },
            "additionalProperties": false
        }
    },
    "additionalProperties": false
}